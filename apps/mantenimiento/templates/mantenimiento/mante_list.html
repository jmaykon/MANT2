{% load static %}
{% block content %}
<div class="tickets-container">
    {% for ticket in tickets %}
    <div class="ticket" id="ticket-{{ ticket.id_ticket }}">

        <!-- Columna Izquierda -->
        <div class="stub">
            <div class="text-center">
                <span class="admit">Ticket</span>
                <span class="line"></span>
            </div>
            <div class="number">{{ ticket.id_ticket }}</div>
        </div>

        <!-- Columna Centro -->
        <div class="check">
            <div class="big">{{ ticket.get_tipo_soporte_display }}</div>
            <div class="number">{{ ticket.insumos_utilizados }}</div>
            <div class="descripcion">
                {{ ticket.descripcion }}
            </div>

            {% if ticket.descripcion|length > 100 %}
            <button class="btn-ver-mas" data-ticket-id="{{ ticket.id_ticket }}">Mostrar descripción</button>
            {% endif %}

            <!-- Información adicional -->
            <div class="info">
                <section>
                    <div class="title">Fecha</div>
                    <div>{{ ticket.fecha_creacion|date:"d/m/Y" }}</div>
                </section>
                <section>
                    <div class="title">Usuario</div>
                    <div>{{ ticket.id_users.nombre }} {{ ticket.id_users.apellido_p }} {{ ticket.id_users.apellido_m }}
                    </div>
                </section>
                <section>
                    <div class="title">Prioridad:<br>
                        {% if ticket.prioridad == 'baja' %}<span class="baja">Baja</span>{% endif %}
                        {% if ticket.prioridad == 'media' %}<span class="media">Media</span>{% endif %}
                        {% if ticket.prioridad == 'alta' %}<span class="alta">Alta</span>{% endif %}
                        {% if ticket.prioridad == 'urgente' %}<span class="urgente">Urgente</span>{% endif %}
                    </div>
                </section>
            </div>
        </div>

        <!-- Columna Derecha -->
        <div class="estado flex flex-col items-center p-4">
            <div class="flex flex-col gap-1 mb-1">
                <button id="btnAtender"
                    class="bg-blue-600 text-white px-0.5 py-0.5  rounded-lg hover:bg-blue-700 transition">
                    Atender
                </button>
                <button class="px-0.5 py-0.5 text-white bg-blue-500 rounded hover:bg-blue-600">Designar</button>
                <button class="px-0.5 py-0.5 text-white bg-red-500 rounded hover:bg-red-600">Cancelar</button>
            </div>

            <div class="status">Estado:<br>
                {% if ticket.estado_ticket == 'pendiente' %}<span class="pendiente">Pendiente</span>{% endif %}
                {% if ticket.estado_ticket == 'en_proceso' %}<span class="en_proceso">En Proceso</span>{% endif %}
                {% if ticket.estado_ticket == 'completado' %}<span class="completado">Completado</span>{% endif %}
                {% if ticket.estado_ticket == 'cancelado' %}<span class="cancelado">Cancelado</span>{% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <p>No hay tickets disponibles.</p>
    {% endfor %}
</div>

<!-- MODAL ATENDER -->
<div id="modal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden">

    <div class="bg-white rounded-xl w-96 p-6 shadow-lg relative">

        <h2 class="text-center text-xl font-semibold mb-6">
            Atender Ticket
        </h2>

        <!-- Pasos -->
        <div class="flex justify-between items-center mb-6">

            <div class="flex flex-col items-center step" data-step="1">
                <div class="step-circle">1</div>
                <span class="mt-2 text-sm">Pendiente</span>
            </div>

            <div class="flex flex-col items-center step" data-step="2">
                <div class="step-circle">2</div>
                <span class="mt-2 text-sm">En Proceso</span>
            </div>

            <div class="flex flex-col items-center step" data-step="3">
                <div class="step-circle">3</div>
                <span class="mt-2 text-sm">Completado</span>
            </div>

        </div>

        <!-- Contenido -->
        <div class="modal-body min-h-[200px]">

            <div class="step-content" data-step="1">
                <p class="text-gray-700">
                    Ticket pendiente de atención.
                </p>
            </div>

            <div class="step-content hidden" data-step="2">
                <p class="text-gray-700">
                    Ticket en proceso de atención.
                </p>
            </div>

            <div class="step-content hidden" data-step="3">
                <form class="space-y-3">
                    <div>
                        <label class="text-sm font-medium">Diagnóstico</label>
                        <textarea class="w-full border rounded-md p-2"></textarea>
                    </div>
                    <div>
                        <label class="text-sm font-medium">Solución Aplicada</label>
                        <textarea class="w-full border rounded-md p-2"></textarea>
                    </div>
                    <div>
                        <label class="text-sm font-medium">Observaciones Técnicas</label>
                        <textarea class="w-full border rounded-md p-2"></textarea>
                    </div>
                    <div>
                        <label class="text-sm font-medium">Comentario Usuario</label>
                        <textarea class="w-full border rounded-md p-2"></textarea>
                    </div>
                </form>
            </div>

        </div>

        <!-- Botones -->
        <div class="flex justify-end mt-6 space-x-2">
            <button class="bg-green-500 text-white px-4 py-2 rounded-md btn-next">
                Continuar
            </button>
        </div>

        <!-- Cerrar -->
        <button id="btnCerrar" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-xl font-bold">
            &times;
        </button>

    </div>
</div>

<link rel="stylesheet" href="{% static 'css/mantenimiento/ticket.css' %}">
<script src="{% static 'js/mantenimiento/atender.js' %}"></script>
{% endblock %}